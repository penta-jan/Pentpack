\NeedsTeXFormat{LaTeX2e} 
\ProvidesPackage{pentpack}[2020/03/03 Package to draw Pentagame diagrams]

\RequirePackage[dvipsnames]{xcolor}
\RequirePackage{xkeyval}
\RequirePackage{environ}
\RequirePackage{tikz}
\RequirePackage{ifthen}
\RequirePackage{xfp}
\usetikzlibrary{positioning}
\usetikzlibrary{arrows}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{calc}

\newcommand{\myred}{WildStrawberry}
\newcommand{\myblue}{Cerulean}
\newcommand{\mywhite}{white}
\newcommand{\myyellow}{Goldenrod}
\newcommand{\mygreen}{SpringGreen}
\newcommand{\blackness}{black!55}
\newcommand{\linecolor}{black}
\newcommand{\rota}{}
\newlength{\ringwidth}

\newboolean{details}
\setboolean{details}{true}

\newcommand{\nona}{}  % node name to be passed 

\newlength{\pfeildicke}
\setlength{\pfeildicke}{2pt}

\DeclareOptionX{rotate}{
    \renewcommand{\rota}{#1}
}

\DeclareOptionX{blackness}{
    \renewcommand{\blackness}{black!#1}
}

\DeclareOptionX{linecolor}{
    \renewcommand{\blackness}{#1}
}

\DeclareOptionX{linewidth}{
    \setlength{\pfeildicke}{#1}
}

\DeclareOptionX{linecolor}{
    \renewcommand{\linecolor}{#1}
}

\DeclareOptionX{simple}{
    \setboolean{details}{false}
%    \renewcommand{\myred}{white}
%    \renewcommand{\myblue}{white}
%    \renewcommand{\mywhite}{white}
%    \renewcommand{\myyellow}{white}
%    \renewcommand{\mygreen}{white}
}

\DeclareOptionX{white}{
    \renewcommand{\myred}{white}
    \renewcommand{\myblue}{white}
    \renewcommand{\mywhite}{white}
    \renewcommand{\myyellow}{white}
    \renewcommand{\mygreen}{white}
}

\DeclareOptionX{sw}{
    \renewcommand{\myred}{gray!10}
    \renewcommand{\myblue}{gray!15}
    \renewcommand{\mywhite}{gray!11}
    \renewcommand{\myyellow}{gray!38}
    \renewcommand{\mygreen}{gray!50}
}

\DeclareOptionX{bunt}{
    \renewcommand{\myred}{WildStrawberry}
    \renewcommand{\myblue}{Cerulean}
    \renewcommand{\mywhite}{white}
    \renewcommand{\myyellow}{Goldenrod}
    \renewcommand{\mygreen}{SpringGreen}
}


\ExecuteOptionsX{rotate=90,blackness=40,linecolor=black}\relax
\ProcessOptionsX\relax


%%%%%%%%%% COMMANDS

\newlength{\svar}    %stop
\newlength{\jvar}   % junction
\newlength{\cvar}   % corner
\newlength{\kvar}   % circle (kreis) ! NICHT Umkreis
\newlength{\fvar}   % figure
\newlength{\ringvar} % dicke verbindungsring



%\def\rota{90}
\def\meinpfeil{triangle 45}


%% Commands for drawing lines and corner blocks

\newcommand{\linie}[3]{
    \draw[#3,line width=\pfeildicke,>=\meinpfeil,cap=round] (#1.center) -- (#2.center)
}

\newcommand{\bogen}[2]{
    \draw[#2,>=\meinpfeil,line width=\pfeildicke,cap=round] ({72*(#1-1)+\rota}:\kvar)  arc ({72*(#1-1)+\rota}:{72*(#1)+\rota}:\kvar)
}

\newcommand{\kbogen}[4]{
    \draw[#4,>=\meinpfeil,line width=\pfeildicke,cap=round] ({72*(#1-1)+\rota+(#2)*18}:\kvar)  arc ({72*(#1-1)+\rota+(#2)*18}:{18*(#1)+\rota+(#3+#2)*18}:\kvar) 
}

\newcommand{\block}[2]{
    \filldraw[draw=black,fill=#2] (#1) circle (\fvar)
}

\newcommand{\highlight}[1]{
    \ifthenelse{\boolean{details}}{
    \draw (#1) circle (3\svar);}{
    }
    \draw[line width=0.5\pfeildicke,<-,>=latex] (#1) -- ($(#1)!6*\svar!(0,0)$);
}

%%% PICS

\tikzset{
    small/.style={line width=0.3pt,draw=black,fill=gray!15}
}

\tikzset{
    corn/.pic={    
    \filldraw[draw=black, fill, line width=0.3pt] (0,0) circle (\cvar);
        \foreach \q in {1,...,6} {
            \ifthenelse{\boolean{details}}{\filldraw[small] ({-162+\rota}:{\cvar+\q*2*\svar-\svar}) circle (\svar);}{}
            \node (\s+\q) at ({-162+\rota}:{\cvar+\q*2*\svar-\svar}) {};        
            }
        \foreach \q in {1,...,6} {
            \ifthenelse{\boolean{details}}{\filldraw[small] ({-198+\rota}:{\cvar+\q*2*\svar-\svar}) circle (\svar);}{}
            \node (\s-\q) at ({-198+\rota}:{\cvar+\q*2*\svar-\svar}) {};
            }
    }
}

\tikzset{
    ccorn/.pic={    
        \filldraw[small,fill=black] (-162+\rota:\cvar+3*2*\svar-\svar) circle (\fvar);
    }
}


\tikzset{
    junc/.pic={    
    \filldraw[draw=black, fill, line width=0.3pt] (0,0) circle (\jvar);
        \foreach \q in {1,...,3} {
            \ifthenelse{\boolean{details}}{\filldraw[small] ({-54+\rota}:{\jvar+\q*2*\svar-\svar}) circle (\svar);}{}
            \node (\s a\q) at ({-54+\rota}:{\jvar+\q*2*\svar-\svar}) {};
            }
    }
}

\tikzset{
    cjunc/.pic={    
    \filldraw[small,fill=black] (\rota:\fpeval{\kvar/3.2}) circle (\fvar);
    }
}

\tikzset{
    triangle/.style = {inner sep=0.5\fvar, regular polygon, regular polygon sides=3 }
}

\tikzset{
    square/.style = {inner sep=0.7\fvar,regular polygon, regular polygon sides=4 }
}
 
%%% COMMANDS

\newcommand{\cjunct}[1]{
     \filldraw[fill=black] ({#1*72+\rota}:{\kvar/3.24}) circle (\fvar);
}

\newcommand{\ccornl}[1]{
     \draw ({#1*72+\rota}:\kvar) pic[rotate={#1*72}] {ccorn};
}

\newcommand{\ccornr}[1]{
     \draw ({#1*72+\rota}:\kvar) pic[rotate={#1*72-36}] {ccorn};
}

\newcommand{\cbog}[1]{
    \filldraw[fill=black] ({#1*72+36+\rota}:\kvar) circle (\fvar);
}

%% Pieces in standard forms
\newcommand{\tri}[2]{
    \node[triangle,draw,fill=#2] at (#1) {}
}

\newcommand{\squ}[2]{
    \node[square,draw,fill=#2] at (#1) {}
}

%% Two pieces at a node

\newcommand{\two}[3]{
    \node[triangle,draw,fill=#2,xshift=-\svar] at (#1) {};
    \node[square,draw,fill=#3,xshift=\svar] at (#1) {};
}



% Drawing the board

\tikzset{
    myboard/.pic={
        \ifthenelse{\boolean{details}}{
            \fill[color=\blackness] (0,0) circle (\kvar+\cvar) ;
            \draw (0,0) circle (\kvar+\cvar);
            \draw[line width=\ringwidth,color=gray!15] (0,0) circle (\kvar) ;
            \draw[line width=0.3pt,color=black] (0,0) circle (\kvar+0.5\ringwidth) ;
            \draw[line width=0.3pt,color=black] (0,0) circle (\kvar-0.5\ringwidth) ;
        }{
            \draw[dashed] (0,0) circle (\kvar);
        }
        \foreach \s in {0,...,5} { 
            \foreach \t in {1,...,3} {
                \node (\s r\t) at ({\t*18+\rota+\s*72}:\kvar) {};
               \ifthenelse{\boolean{details}}{\filldraw[small] ({\t*18+\rota+\s*72}:\kvar) circle (\svar);}{}
            }
        }
        \foreach \s in {0,...,5} {% defines 6/5 nodes where 0=5 white
            \node (\s) at ({\rota+72*\s}:\kvar){};   
            \node (\s a) at ({\rota+72*\s}:{-\kvar/2.618}) {};
        }
        \ifthenelse{\boolean{details}}{}{
            \draw[dotted] (0) -- (2);
            \draw[dotted] (1) -- (3);
            \draw[dotted] (2) -- (4);
            \draw[dotted] (3) -- (0);
            \draw[dotted] (4) -- (1);
        }
        \foreach \s in {0,...,5} {% draws connecting stops
            \ifthenelse{\s=0}{\def\mycolor{\mywhite}}{}
            \ifthenelse{\s=1}{\def\mycolor{\mygreen}}{}
            \ifthenelse{\s=2}{\def\mycolor{\myyellow}}{}
            \ifthenelse{\s=3}{\def\mycolor{\myred}}{}
            \ifthenelse{\s=4}{\def\mycolor{\myblue}}{}
            \ifthenelse{\s=5}{\def\mycolor{\mywhite}}{}
            \draw ({\rota+72*\s}:\kvar) pic[color=\mycolor,rotate={72*\s}] {corn}; 
            \draw ({\rota+72*\s}:{-\kvar/2.618}) pic[color=\mycolor,rotate={72*\s}] {junc};
        }
        
    }
}

\NewEnviron{pentdiag}[1]{\setlength{\kvar}{\fpeval{#1/2}pt}\setlength{\svar}{\fpeval{\kvar/22.38133}pt}\setlength{\jvar}{\fpeval{2.02606*\svar}pt}\setlength{\cvar}{\fpeval{2.23606*\svar}pt}\setlength{\fvar}{\fpeval{0.75*\svar}pt}\setlength{\ringwidth}{\fpeval{0.4*\svar}pt}\setlength{\pfeildicke}{\fpeval{0.8*\svar}pt}\relax
    \begin{tikzpicture}[draw=\linecolor]
        \pic{myboard};
        \BODY%
    \end{tikzpicture}%
}

\endinput